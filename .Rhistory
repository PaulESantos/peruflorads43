)) |>
select(id, categoria, especie, scientific_name, familia) |>
arrange(especie) |>
select(1:3)
ds43 |>
filter(fuente == "adiciones")
library(tidyverse)
ds43 <- readxl::read_xlsx("ds_043_2016_p.xlsx")
ds43
ds43 |>
select(especie)
ds43 |>
select(especie, genero, specific_epithet)
ds43 |>
select(especie, genero, specific_epithet) |>
mutate(author = str_remove_all(especie,
paste0(genero, "|", specific_epithet)))
ds43 |>
select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero, "|", specific_epithet)) |>
str_squish())
ds43
ds43 |>
filter(!is.na(tag))
ds43 |>
filter(!is.na(tag))
ds43 |>
filter(!is.na(forma))
ds43 |>
filter(!is.na(forma)) |>
select(especie, genero, specific_epithet)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"| ",
forma, " ")) |>
str_squish())
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"| ",
forma, " ")) |>
str_squish()) |>
filter(!is.na(forma)) |>
select(especie, genero, specific_epithet)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"| ",
forma, " ")) |>
str_squish()) |>
filter(!is.na(forma)) |>
select(especie, author)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"| ",
forma, " ",
"| subsp\\. | forma ")) |>
str_squish()) |>
filter(!is.na(forma)) |>
select(especie, author)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"| ",
forma,
"| subsp\\. | forma ")) |>
str_squish()) |>
filter(!is.na(forma)) |>
select(especie, author)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"|",
forma,
"| subsp\\. | forma ")) |>
str_squish()) |>
filter(!is.na(forma)) |>
select(especie, author)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"|",
forma,
"| subsp\\. | forma ")) |>
str_squish()) |>
filter(!is.na(tag)) |>
select(especie, author)
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"|",
forma,
"| subsp\\. | forma ")) |>
str_squish())
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"|",
forma,
"| subsp\\. | forma ")) |>
str_squish()) |>
writexl::write_xlsx("ds_043_2006.xlsx")
ds43 |>
#select(especie, genero, specific_epithet) |>
rowwise() |>
mutate(author = str_remove_all(especie,
paste0(genero,
"|",
specific_epithet,
"|",
infraespecie,
"|",
forma,
"| subsp\\. | forma ")) |>
str_squish()) |>
writexl::write_xlsx("ds_043_2006_092025.xlsx")
library(tidyverse)
library(TNRS)
df <- readxl::read_excel("ds_043_2006_092025.xlsx")
species <- df$scientific_name |>  unique()
length(species)
df |>
count(scientific_name) |>
filter(n>1)
length(species)
ds_tnrs <- TNRS(species,
sources = "wcvp")
ds_tnrs
ds_tnrs |>
select(Name_submitted,
contains("Accepted"))
ds_tnrs |>
select(Name_submitted,
contains("Accepted_"))
ds_tnrs |>
select(Name_submitted,
Accepted_name,
Accepted_name_author,
Accepted_family,
acce)
ds_tnrs |>
select(Name_submitted,
Accepted_name,
Accepted_name_author,
Accepted_family)
ds_tnrs |>
select(Name_submitted,
Accepted_name,
Accepted_name_author,
Accepted_family) |>
as_tibble()
ds_tnrs |>
select(Name_submitted,
Accepted_name,
Accepted_name_author,
Accepted_family) |>
as_tibble() |>
writexl::write_xlsx("ds_043_2006_092025_tnrs.xlsx")
df <- readxl::read_excel("ds_043_2006_092025.xlsx")
df <- readxl::read_excel("ds_043_2006_092025_tnrs.xlsx")
df
df <- readxl::read_excel("ds_043_2006_092025.xlsx")
df2 <- readxl::read_excel("ds_043_2006_092025_tnrs.xlsx")
df
df2
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
df
library(tidyverse)
df |>
add_count(scientific_name)
df |>
add_count(scientific_name) |>
filter(n != 1)
df |>
add_count(scientific_name) |>
filter(n != 1) |>
select(scientific_name)
df |>
add_count(scientific_name) |>
filter(n != 1)
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
df
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
df |>
add_count(scientific_name) |>
filter(n != 1) |>
select(scientific_name)
df |>
add_count(scientific_name) |>
filter(n != 1)
df |>
dplyr::slice(-21)
df2
df |>
dplyr::slice(-21) |>
dplyr::left_join(df2,
by = c(
"scientific_name" = "Name_submitted"
))
df |>
dplyr::slice(-21) |>
dplyr::left_join(df2,
by = c(
"scientific_name" = "Name_submitted"
))
species <- df$scientific_name |>  unique()
length(species)
ds_tnrs <- TNRS(species,
sources = "wcvp")
library(TNRS)
ds_tnrs <- TNRS(species,
sources = "wcvp")
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
df |>
write_csv("ds_043_2006_092025.csv")
df |>
write_delim("ds_043_2006_092025.txt", delim = "\t")
usethis::create_tidy_package("D:\\ds43")
options(cli.ignore_unknown_rstudio_theme = TRUE)
library(tidyverse)
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
df_tnrs <- readxl::read_excel("ds_043_2006_092025_tnrs.xlsx")
df
df_tnrs
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct() |>
dplyr::slice(21,42)
df
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct() |>
dplyr::slice(-42)
df
df
df_tnrs
df |>
dplyr::left_join(df_tnrs,
by = c("scientific_name" = "Name_submitted"))
ds43 <- df |>
dplyr::left_join(df_tnrs,
by = c("scientific_name" = "Name_submitted"))
ds43 |>
dplyr::select(author, Accepted_name_author)
ds43 |>
dplyr::select(author, Accepted_name_author) |>
dplyr::mutate(comp = Accepted_name_author == author)
ds43 |>
dplyr::select(author, Accepted_name_author) |>
dplyr::mutate(comp = Accepted_name_author == author) |>
dplyr::filter(comp != TRUE)
ds43 <- df |>
dplyr::left_join(df_tnrs,
by = c("scientific_name" = "Name_submitted")) |>
dplyr::mutate(comp = Accepted_name_author == author)
ds43 |>
writexl::write_xlsx("ds_043_2006_092025_f1.xlsx")
df <- readxl::read_excel("ds_043_2006_092025.xlsx") |>
dplyr::distinct()
library(TNRS)
df
spcies <- df$scientific_name |>
unique()
df_tnrs <- TNRS::TNRS(spcies,
sources = "wcvp")
df_tnrs |>
dplyr::select(Name_submitted,
Accepted_name,
Accepted_family,
Accepted_name_author,
Taxonomic_status)
df_tnrs |>
dplyr::select(Name_submitted,
Accepted_name,
Accepted_family,
Accepted_name_author,
Taxonomic_status) |>
tibble::as_tibble()
df_tnrs_1 <- df_tnrs |>
dplyr::select(Name_submitted,
Accepted_name,
Accepted_family,
Accepted_name_author,
Taxonomic_status) |>
tibble::as_tibble()
df_tnrs_1 |>
writexl::write_xlsx("ds_043_2006_092025_tnrs.xlsx")
df_tnrs <- readxl::read_excel("ds_043_2006_092025_tnrs.xlsx")
df
df_tnrs
ds43 <- df |>
dplyr::slice(-21) |>
dplyr::left_join(df_tnrs,
by = c("scientific_name" = "Name_submitted")) |>
dplyr::mutate(comp = Accepted_name_author == author)
ds43 |>
writexl::write_xlsx("ds_043_2006_092025_f1.xlsx")
devtools::document()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::check()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::load_all()
devtools::check()
devtools::document()
devtools::load_all()
devtools::check()
devtools::load_all()
peruflorads43:::threatenedperu
peruflorads43:::threatenedperu_syn
load("D:/peruflorads43/R/sysdata.rda")
devtools::document()
devtools::load_all()
devtools::check()
splist <- c(NA, NA, "Aphelandra formosa")
splist <- c(NA, NA)
is_threatened_peru(splist)
is_threatened_peru(threatenedperu$scientific_name[c(23, 45, 123, 234)])
input <- c("Microchilus", "Opuntia pubescens"  )
is_threatened_peru(splist = input)
matching_threatenedperu(splist = threatenedperu$scientific_name[c(23, 45, 123, 234)],
source = "original")
tictoc::tic()
original_ds <- is_threatened_peru(threatenedperu$scientific_name,
return_details = TRUE,
source = "original")
tictoc::toc()
original_ds |>
dplyr::select(Orig.Name, Matched.Name) |>
dplyr::mutate(compara = Orig.Name == Matched.Name) |>
dplyr::filter(compara != TRUE) |>
as.data.frame()
tictoc::tic()
updated_ds <- is_threatened_peru(threatenedperu_syn$accepted_name,
return_details = TRUE,
source = "updated")
tictoc::toc()
updated_ds |>
dplyr::select(Orig.Name, Matched.Name) |>
dplyr::filter(Matched.Name != "---") |>
dplyr::mutate(compara = Orig.Name == Matched.Name) |>
dplyr::filter(compara != TRUE) |>
as.data.frame()
result <- is_threatened_peru(c("Persea americana",
"catleya maxima",
"catleya maxima",
"persea incana"
),
return_details = TRUE)
result |>
as.data.frame()
get_ambiguous_matches(result, "genus")
splist <- "Haageocereus acranthus subsp. olowinskianus f. deflexispinus"
result <- matching_threatenedperu(splist = splist)
get_ambiguous_matches(result, type = "infraspecies")
result <- is_threatened_peru(splist = splist, return_details = TRUE)
get_ambiguous_matches(result, type = "infraspecies")
get_ambiguous_matches(result)
is_threatened_peru(splist)
is_threatened_peru(c( "Cattleya maxima var. alba",  "Cattleya maxima))
is_threatened_peru(c( "Cattleya maxima var. alba",  "Cattleya maxima"))
check_ds043(c( "Cattleya maxima var. alba",  "Cattleya maxima"))
matching_threatenedperu(c( "Cattleya maxima var. alba",  "Cattleya maxima"))
species_dup <- c(
"Cattleya maxima",
"Polylepis incana",
"Cattleya maxima"  # Duplicate
)
is_threatened_peru(species_dup)
splist <- "Haageocereus acranthus subsp. olowinskianus f. deflexispinus"
result <- is_threatened_peru(splist = splist)
get_ambiguous_matches(result, type = "infraspecies")
result <- is_threatened_peru(splist = splist, return_details = TRUE)
get_ambiguous_matches(result, type = "infraspecies")
devtools::document()
devtools::load_all()
devtools::check()
pak::pak("PaulESantos/peruflorads43")
library(peruflorads43)
# Simple vector of species names
species_list <- c(
"Cattleya maxima",           # Orchid - Endangered
"Polylepis incana",          # Queñua tree - Vulnerable
"Persea americana"           # Avocado - Not threatened
)
# Check threat status
is_threatened_peru(species_list)
library(peruflorads43)
# Simple vector of species names
species_list <- c(
"Cattleya maxima",           # Orchid - Endangered
"Polylepis incana",          # Queñua tree - Vulnerable
"Persea americana"           # Avocado - Not threatened
)
# Check threat status
tibble::tibble(splist = species_list) |>
dplyr::mutate(ds43 = is_threatened_peru(splist))
# Species with nomenclatural changes
species <- c(
"Haageocereus acranthus subsp. olowinskianus",  # Original name (2006)
"Brassia ocanensis",                            # Updated name (was Ada)
"Persea americana"                              # Not threatened
)
# Consolidated search across both databases
status <- is_ds043_2006_ag(species)
status
# Detailed reconciliation
details <- is_ds043_2006_ag(species, return_details = TRUE)
details |>
dplyr::select(Input.Name, Consolidated.Status, Final.Source, Nomenclature.Status)
# Species with nomenclatural changes
species <- c(
"Haageocereus acranthus subsp. olowinskianus",  # Original name (2006)
"Brassia ocanensis",                            # Updated name (was Ada)
"Persea americana"                              # Not threatened
)
# Consolidated search across both databases
tibble::tibble(species) |>
dplyr::mutate(status = is_ds043_2006_ag(species))
status
# Detailed reconciliation
details <- is_ds043_2006_ag(species, return_details = TRUE)
details |>
dplyr::select(Input.Name, Consolidated.Status, Final.Source, Nomenclature.Status)
# Species with nomenclatural changes
species <- c(
"Haageocereus acranthus subsp. olowinskianus",  # Original name (2006)
"Brassia ocanensis",                            # Updated name (was Ada)
"Persea americana"                              # Not threatened
)
# Consolidated search across both databases
tibble::tibble(species) |>
dplyr::mutate(status = is_ds043_2006_ag(species))
# Detailed reconciliation
details <- is_ds043_2006_ag(species, return_details = TRUE)
details |>
dplyr::select(Input.Name, Consolidated.Status, Final.Source, Nomenclature.Status)
